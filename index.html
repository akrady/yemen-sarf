<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق الصرف اليمني</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Tajawal -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* UPDATED: Made the app container responsive */
        .app-container {
            max-width: 420px;
            width: 100%;
            height: 95vh; /* Use 95% of the viewport height */
            max-height: 880px; /* Set a maximum height for very tall screens */
            border-radius: 2.5rem;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25), 0 0 15px rgb(0 0 0 / 0.1);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .nav-item.active svg, .nav-item.active span {
            color: #3b82f6; /* blue-500 */
        }
        /* Dark mode styles */
        .dark .bg-gray-50 { background-color: #111827; }
        .dark .bg-white { background-color: #1f2937; }
        .dark .text-gray-800 { color: #f9fafb; }
        .dark .text-gray-600 { color: #d1d5db; }
        .dark .text-gray-500 { color: #9ca3af; }
        .dark .text-gray-400 { color: #9ca3af; }
        .dark .border-gray-200 { border-color: #374151; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.4); }
        .dark .divide-y-2 > :not([hidden]) ~ :not([hidden]) { border-color: #374151; }
        .dark .app-container { box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.5), 0 0 15px rgb(0 0 0 / 0.3); }
        .dark .splash-screen { background-color: #111827; }
        /* Update animation */
        @keyframes flash {
            0% { background-color: transparent; }
            25% { background-color: rgba(59, 130, 246, 0.1); }
            100% { background-color: transparent; }
        }
        .price-updated {
            animation: flash 1s ease-out;
        }
    </style>
</head>
<body class="bg-gray-200 dark:bg-gray-800 flex items-center justify-center min-h-screen p-4">
    <div id="app" class="app-container bg-gray-50 flex flex-col">
        <!-- Splash Screen -->
        <div id="splash-screen" class="splash-screen absolute inset-0 bg-gray-50 z-50 flex flex-col items-center justify-center transition-opacity duration-500">
            <!-- Original Code-based Icon (Reliable and works offline) -->
            <div class="w-32 h-32 bg-blue-600 rounded-3xl flex items-center justify-center shadow-lg mb-4">
                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center">
                    <div class="relative w-14 h-14">
                        <svg viewBox="0 0 100 60" class="w-full h-full">
                            <rect width="100" height="20" fill="#CE1126"/>
                            <rect y="20" width="100" height="20" fill="#FFFFFF"/>
                            <rect y="40" width="100" height="20" fill="#000000"/>
                        </svg>
                        <span class="absolute -left-5 top-1/2 -translate-y-1/2 text-blue-600 text-4xl font-bold">$</span>
                        <span class="absolute -right-5 top-1/2 -translate-y-1/2 text-blue-600 text-4xl font-bold">€</span>
                    </div>
                </div>
            </div>
            <h1 class="text-2xl font-bold text-gray-800">تطبيق الصرف اليمني</h1>
            <p class="text-gray-500 mt-2">أسعار الصرف والذهب لحظة بلحظة</p>
        </div>
        <!-- Main Content -->
        <main class="flex-grow overflow-y-auto pb-20">
            <!-- Screen: Home -->
            <div id="screen-home" class="p-4 space-y-6">
                <header class="flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">أسعار الصرف</h1>
                        <p class="text-sm text-gray-500">آخر تحديث: <span id="last-updated">جاري التحديث...</span></p>
                    </div>
                     <div id="loading-indicator" class="p-2 opacity-0 transition-opacity duration-300">
                        <svg class="animate-spin h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                </header>
                <!-- Currency Rates -->
                <div class="space-y-4">
                    <!-- USD Card -->
                    <div id="usd-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4">
                        <div class="flex items-center mb-3">
                            <img src="https://flagcdn.com/w40/us.png" alt="USD Flag" class="w-8 h-8 rounded-full ml-3">
                            <div><h2 class="font-bold text-lg text-gray-800">الدولار الأمريكي</h2><p class="text-sm text-gray-500">USD</p></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                <p class="text-sm text-blue-500 dark:text-blue-400 font-bold">شمال (صنعاء)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="usd-north-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="usd-north-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                <p class="text-sm text-green-500 dark:text-green-400 font-bold">جنوب (عدن)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="usd-south-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="usd-south-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- SAR Card -->
                    <div id="sar-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4">
                        <div class="flex items-center mb-3">
                             <img src="https://flagcdn.com/w40/sa.png" alt="SAR Flag" class="w-8 h-8 rounded-full ml-3">
                            <div><h2 class="font-bold text-lg text-gray-800">الريال السعودي</h2><p class="text-sm text-gray-500">SAR</p></div>
                        </div>
                         <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                <p class="text-sm text-blue-500 dark:text-blue-400 font-bold">شمال (صنعاء)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="sar-north-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="sar-north-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                <p class="text-sm text-green-500 dark:text-green-400 font-bold">جنوب (عدن)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="sar-south-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="sar-south-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- AED Card -->
                    <div id="aed-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4">
                        <div class="flex items-center mb-3">
                             <img src="https://flagcdn.com/w40/ae.png" alt="AED Flag" class="w-8 h-8 rounded-full ml-3">
                            <div><h2 class="font-bold text-lg text-gray-800">الدرهم الإماراتي</h2><p class="text-sm text-gray-500">AED</p></div>
                        </div>
                         <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                <p class="text-sm text-blue-500 dark:text-blue-400 font-bold">شمال (صنعاء)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="aed-north-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="aed-north-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                <p class="text-sm text-green-500 dark:text-green-400 font-bold">جنوب (عدن)</p>
                                <div class="flex justify-around mt-2">
                                    <div><p class="text-xs text-gray-500">شراء</p><p id="aed-south-buy" class="font-bold text-lg text-gray-800">...</p></div>
                                    <div><p class="text-xs text-gray-500">بيع</p><p id="aed-south-sell" class="font-bold text-lg text-gray-800">...</p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Gold Prices -->
                <div class="mt-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-3">أسعار الذهب</h2>
                    <div id="gold-card" class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 space-y-3">
                        <!-- 24 Karat -->
                        <div class="flex items-center justify-between">
                             <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-full ml-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                                <span class="font-bold text-gray-800">عيار 24</span>
                            </div>
                            <div class="text-left">
                                <p class="text-sm font-semibold text-blue-500 dark:text-blue-400"><span id="gold-24-north">...</span> <span class="text-xs text-gray-400">(شمال)</span></p>
                                <p class="text-sm font-semibold text-green-500 dark:text-green-400"><span id="gold-24-south">...</span> <span class="text-xs text-gray-400">(جنوب)</span></p>
                            </div>
                        </div>
                         <hr class="border-gray-200"/>
                        <!-- 21 Karat -->
                         <div class="flex items-center justify-between">
                             <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-full ml-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                                <span class="font-bold text-gray-800">عيار 21</span>
                            </div>
                             <div class="text-left">
                                <p class="text-sm font-semibold text-blue-500 dark:text-blue-400"><span id="gold-21-north">...</span> <span class="text-xs text-gray-400">(شمال)</span></p>
                                <p class="text-sm font-semibold text-green-500 dark:text-green-400"><span id="gold-21-south">...</span> <span class="text-xs text-gray-400">(جنوب)</span></p>
                            </div>
                        </div>
                        <hr class="border-gray-200"/>
                        <!-- 18 Karat -->
                         <div class="flex items-center justify-between">
                             <div class="flex items-center">
                                <div class="p-2 bg-yellow-100 rounded-full ml-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                                <span class="font-bold text-gray-800">عيار 18</span>
                            </div>
                             <div class="text-left">
                                <p class="text-sm font-semibold text-blue-500 dark:text-blue-400"><span id="gold-18-north">...</span> <span class="text-xs text-gray-400">(شمال)</span></p>
                                <p class="text-sm font-semibold text-green-500 dark:text-green-400"><span id="gold-18-south">...</span> <span class="text-xs text-gray-400">(جنوب)</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Screen: Calculator -->
            <div id="screen-calculator" class="p-4 hidden">
                 <header>
                    <h1 class="text-2xl font-bold text-gray-800 text-center">حاسبة الصرف</h1>
                </header>
                <div class="mt-8 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 space-y-6">
                    <div>
                        <label for="amount" class="text-sm font-medium text-gray-600">المبلغ</label>
                        <div class="relative mt-1">
                            <input type="number" id="amount" class="w-full bg-gray-100 dark:bg-gray-700 border-2 border-transparent focus:border-blue-500 focus:ring-0 rounded-lg text-3xl font-bold text-gray-800 p-4 text-center" placeholder="0">
                            <div class="absolute left-4 top-1/2 -translate-y-1/2">
                                <select id="source-currency" class="bg-transparent font-semibold text-gray-500 border-0 focus:ring-0">
                                    <option value="USD" selected>USD</option>
                                    <option value="SAR">SAR</option>
                                    <option value="AED">AED</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="text-sm font-medium text-gray-600">التحويل إلى</label>
                        <div class="grid grid-cols-2 gap-3 mt-2">
                            <button id="btn-north" class="target-region-btn active-region p-3 rounded-lg font-semibold border-2 border-blue-500 bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400">ريال يمني (شمال)</button>
                            <button id="btn-south" class="target-region-btn p-3 rounded-lg font-semibold border-2 border-gray-300 dark:border-gray-600 text-gray-500">ريال يمني (جنوب)</button>
                        </div>
                    </div>
                    <button id="calculate-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg flex items-center justify-center text-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2Z"/><path d="m9 14 3-3 3 3"/><path d="M12 17V7"/></svg>
                        حساب
                    </button>
                </div>
                <div id="result-card" class="mt-6 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 text-center hidden">
                    <p class="text-gray-500">النتيجة النهائية</p>
                    <p class="text-4xl font-bold text-gray-800 my-2"><span id="result-amount">0</span> <span class="text-2xl">ريال يمني</span></p>
                    <p class="text-sm text-gray-400">حسب سعر بيع <span id="result-region"></span>: <span id="result-rate">0</span></p>
                </div>
            </div>
            <!-- Screen: Settings -->
            <div id="screen-settings" class="p-4 hidden">
                 <header>
                    <h1 class="text-2xl font-bold text-gray-800 text-center">الإعدادات</h1>
                </header>
                <div class="mt-8 space-y-4">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-2">
                        <ul class="divide-y-2 divide-gray-200">
                            <li class="flex items-center justify-between p-4">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 ml-4"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                                    <span class="font-semibold text-gray-800">الوضع الليلي</span>
                                </div>
                                <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" value="" id="dark-mode-toggle" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </li>
                             <li class="flex items-center justify-between p-4">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 ml-4"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
                                    <span class="font-semibold text-gray-800">تفعيل الإشعارات</span>
                                </div>
                                <label for="notifications-toggle" class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" value="" id="notifications-toggle" class="sr-only peer" checked>
                                  <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </li>
                        </ul>
                    </div>
                     <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-2 mt-4">
                        <ul class="divide-y-2 divide-gray-200">
                            <li id="about-app-btn" class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 ml-4"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                                    <span class="font-semibold text-gray-800">عن التطبيق</span>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><polyline points="15 18 9 12 15 6"></polyline></svg>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Screen: About -->
            <div id="screen-about" class="p-4 hidden">
                <header class="relative flex justify-center items-center mb-8">
                    <button id="back-to-settings-btn" class="absolute right-0 top-1/2 -translate-y-1/2 p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><polyline points="9 18 15 12 9 6"></polyline></svg>
                    </button>
                    <h1 class="text-2xl font-bold text-gray-800">حول التطبيق</h1>
                </header>
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8 text-center space-y-4">
                    <div class="w-20 h-20 mx-auto bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    </div>
                    <p class="text-lg font-medium text-gray-800">
                        تم تطوير هذا التطبيق من قبل مصمم الجرافيك
                    </p>
                    <p class="text-2xl font-bold text-blue-600">أكرم</p>
                    <p class="text-lg font-medium text-gray-600" dir="ltr">
                        جوال: 774224945
                    </p>
                    <p class="text-sm font-medium text-red-500 mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                        <strong>ملاحظة:</strong> هذا التطبيق للعرض فقط وهو مجرد نسخة تجريبية. الأسعار المعروضة ليست حقيقية ولا يجب الاعتماد عليها في أي معاملات مالية.
                    </p>
                </div>
            </div>
        </main>
        <!-- Bottom Navigation -->
        <nav class="absolute bottom-0 left-0 right-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 flex justify-around rounded-b-3xl">
            <button data-screen="home" class="nav-item flex-1 flex flex-col items-center justify-center p-3 text-gray-500 active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.099a1.998 1.998 0 0 1 3.78 0l6.22 12.44a2 2 0 0 1-1.78 2.96H3.78a2 2 0 0 1-1.78-2.96L8.22 2.1A2 2 0 0 1 12 2.099z"/><path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>
                <span class="text-xs font-semibold mt-1">الأسعار</span>
            </button>
            <button data-screen="calculator" class="nav-item flex-1 flex flex-col items-center justify-center p-3 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="12" x2="12" y1="10" y2="18"/><line x1="16" x2="8" y1="10" y2="10"/></svg>
                <span class="text-xs font-semibold mt-1">الحاسبة</span>
            </button>
            <button data-screen="settings" class="nav-item flex-1 flex flex-col items-center justify-center p-3 text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                <span class="text-xs font-semibold mt-1">الإعدادات</span>
            </button>
        </nav>
    </div>
    <script>
        // --- App Logic ---
        let currentRates = {
            USD: { north: { buy: 0, sell: 0 }, south: { buy: 0, sell: 0 } },
            SAR: { north: { buy: 0, sell: 0 }, south: { buy: 0, sell: 0 } },
            AED: { north: { buy: 0, sell: 0 }, south: { buy: 0, sell: 0 } },
            GOLD: { 
                '24': { north: 0, south: 0 },
                '21': { north: 0, south: 0 },
                '18': { north: 0, south: 0 },
            }
        };
        const elements = {
            lastUpdated: document.getElementById('last-updated'),
            loadingIndicator: document.getElementById('loading-indicator'),
            // Cards
            usdCard: document.getElementById('usd-card'),
            sarCard: document.getElementById('sar-card'),
            aedCard: document.getElementById('aed-card'),
            goldCard: document.getElementById('gold-card'),
            // USD
            usdNorthBuy: document.getElementById('usd-north-buy'),
            usdNorthSell: document.getElementById('usd-north-sell'),
            usdSouthBuy: document.getElementById('usd-south-buy'),
            usdSouthSell: document.getElementById('usd-south-sell'),
            // SAR
            sarNorthBuy: document.getElementById('sar-north-buy'),
            sarNorthSell: document.getElementById('sar-north-sell'),
            sarSouthBuy: document.getElementById('sar-south-buy'),
            sarSouthSell: document.getElementById('sar-south-sell'),
            // AED
            aedNorthBuy: document.getElementById('aed-north-buy'),
            aedNorthSell: document.getElementById('aed-north-sell'),
            aedSouthBuy: document.getElementById('aed-south-buy'),
            aedSouthSell: document.getElementById('aed-south-sell'),
            // Gold
            gold24North: document.getElementById('gold-24-north'),
            gold24South: document.getElementById('gold-24-south'),
            gold21North: document.getElementById('gold-21-north'),
            gold21South: document.getElementById('gold-21-south'),
            gold18North: document.getElementById('gold-18-north'),
            gold18South: document.getElementById('gold-18-south'),
        };

        // 🌐 جلب الأسعار من Replit
        async function fetchLatestRates() {
            try {
                const response = await fetch("https://yemen-sarf-api.akradyabbbb33.repl.co/data.json");
                const data = await response.json();
                return data;
            } catch (err) {
                console.error("فشل جلب البيانات من Replit:", err);
                return currentRates;
            }
        }

        function renderRates(ratesData) {
            currentRates = ratesData;
            // USD
            elements.usdNorthBuy.textContent = ratesData.USD.north.buy.toFixed(2);
            elements.usdNorthSell.textContent = ratesData.USD.north.sell.toFixed(2);
            elements.usdSouthBuy.textContent = Math.round(ratesData.USD.south.buy);
            elements.usdSouthSell.textContent = Math.round(ratesData.USD.south.sell);
            // SAR
            elements.sarNorthBuy.textContent = ratesData.SAR.north.buy.toFixed(2);
            elements.sarNorthSell.textContent = ratesData.SAR.north.sell.toFixed(2);
            elements.sarSouthBuy.textContent = Math.round(ratesData.SAR.south.buy);
            elements.sarSouthSell.textContent = Math.round(ratesData.SAR.south.sell);
            // AED
            elements.aedNorthBuy.textContent = Math.round(ratesData.AED.north.buy);
            elements.aedNorthSell.textContent = Math.round(ratesData.AED.north.sell);
            elements.aedSouthBuy.textContent = Math.round(ratesData.AED.south.buy);
            elements.aedSouthSell.textContent = Math.round(ratesData.AED.south.sell);
            // Gold
            elements.gold24North.textContent = ratesData.GOLD['24'].north.toLocaleString();
            elements.gold24South.textContent = ratesData.GOLD['24'].south.toLocaleString();
            elements.gold21North.textContent = ratesData.GOLD['21'].north.toLocaleString();
            elements.gold21South.textContent = ratesData.GOLD['21'].south.toLocaleString();
            elements.gold18North.textContent = ratesData.GOLD['18'].north.toLocaleString();
            elements.gold18South.textContent = ratesData.GOLD['18'].south.toLocaleString();
            elements.lastUpdated.textContent = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
            [elements.usdCard, elements.sarCard, elements.aedCard, elements.goldCard].forEach(card => {
                card.classList.remove('price-updated');
                void card.offsetWidth;
                card.classList.add('price-updated');
            });
        }

        async function updateData() {
            elements.loadingIndicator.style.opacity = '1';
            const newRatesData = await fetchLatestRates();
            renderRates(newRatesData);
            elements.loadingIndicator.style.opacity = '0';
        }

        document.addEventListener('DOMContentLoaded', () => {
            // إخفاء شاشة التمهيد
            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                if(splash) {
                    splash.style.opacity = '0';
                    setTimeout(() => splash.style.display = 'none', 500);
                }
            }, 2500);

            // أول تحديث
            updateData();

            // تحديث كل 10 دقائق
            setInterval(updateData, 600000);

            // --- Navigation ---
            const navItems = document.querySelectorAll('.nav-item');
            const screens = {
                home: document.getElementById('screen-home'),
                calculator: document.getElementById('screen-calculator'),
                settings: document.getElementById('screen-settings'),
                about: document.getElementById('screen-about')
            };
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    navItems.forEach(i => i.classList.remove('active'));
                    Object.values(screens).forEach(s => s.classList.add('hidden'));
                    item.classList.add('active');
                    screens[item.dataset.screen].classList.remove('hidden');
                });
            });

            // --- Settings to About Navigation ---
            const aboutAppBtn = document.getElementById('about-app-btn');
            const backToSettingsBtn = document.getElementById('back-to-settings-btn');
            if(aboutAppBtn) {
                aboutAppBtn.addEventListener('click', () => {
                    screens.settings.classList.add('hidden');
                    screens.about.classList.remove('hidden');
                });
            }
            if(backToSettingsBtn) {
                backToSettingsBtn.addEventListener('click', () => {
                    screens.about.classList.add('hidden');
                    screens.settings.classList.remove('hidden');
                });
            }

            // --- Calculator Logic ---
            const amountInput = document.getElementById('amount');
            const sourceCurrencySelect = document.getElementById('source-currency');
            const regionButtons = document.querySelectorAll('.target-region-btn');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultCard = document.getElementById('result-card');
            const resultAmountEl = document.getElementById('result-amount');
            const resultRegionEl = document.getElementById('result-region');
            const resultRateEl = document.getElementById('result-rate');
            let selectedRegion = 'north';
            regionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    regionButtons.forEach(b => {
                        b.classList.remove('active-region', 'border-blue-500', 'bg-blue-50', 'text-blue-600', 'dark:bg-blue-900/30', 'dark:text-blue-400');
                        b.classList.add('border-gray-300', 'dark:border-gray-600', 'text-gray-500');
                    });
                    btn.classList.add('active-region', 'border-blue-500', 'bg-blue-50', 'text-blue-600', 'dark:bg-blue-900/30', 'dark:text-blue-400');
                    btn.classList.remove('border-gray-300', 'dark:border-gray-600', 'text-gray-500');
                    selectedRegion = btn.id === 'btn-north' ? 'north' : 'south';
                });
            });
            if(calculateBtn) {
                calculateBtn.addEventListener('click', () => {
                    const amount = parseFloat(amountInput.value);
                    const currency = sourceCurrencySelect.value;
                    if (!amount || amount <= 0) {
                        amountInput.focus();
                        return;
                    }
                    const rate = currentRates[currency][selectedRegion].sell;
                    const result = amount * rate;
                    resultAmountEl.textContent = result.toLocaleString('en-US', {maximumFractionDigits: 2});
                    resultRegionEl.textContent = selectedRegion === 'north' ? 'الشمال' : 'الجنوب';
                    resultRateEl.textContent = rate;
                    resultCard.classList.remove('hidden');
                });
            }

            // --- Dark Mode ---
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('change', () => {
                    document.documentElement.classList.toggle('dark', darkModeToggle.checked);
                });
            }
        });
    </script>
</body>
</html>